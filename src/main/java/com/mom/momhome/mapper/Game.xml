<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="Game">

	
	<insert id="insert" parameterType="GameDto">
	INSERT INTO game
(
TEAM_KEY,
GAME_DATE,
GAME_LOCATION,
GAME_TITLE,
GAME_CONTENTS,
GAME_FDATE
)
VALUES
(
#{team_key},
now(),
#{game_location},
#{game_title},
#{game_contents},
#{game_fdate}

);
	</insert>
	
<select id="list" parameterType="GameDto"  resultType="GameDto">

    
         select GAME_KEY
         ,(select TEAM_NAME from team B where B.TEAM_KEY =A.TEAM_KEY) as TEAM_NAME
		 ,GAME_DATE
		 ,GAME_LOCATION
		 ,GAME_TITLE
		 ,GAME_CONTENTS
		 ,GAME_FDATE
		 ,rnum
		 from
 		(
 		select
 		A.GAME_KEY
 		,A.TEAM_KEY
 		,A.GAME_DATE
 		 ,A.GAME_LOCATION
		 ,A.GAME_TITLE
		 ,A.GAME_CONTENTS
		 ,A.GAME_FDATE
		,@rownum := @rownum+1 AS rnum
		from game A, (select @rownum:=0) B
			<if test='key!=null and keyword!=null'>
				<if test='key=="1"'>
				 	where GAME_TITLE like concat('%',#{keyword}, '%')
				</if>
				<if test='key=="2"'>
				 	where GAME_CONTENTS like concat('%',#{keyword}, '%')	  
				</if>
				<if test='key=="3"'>
					 where GAME_TITLE like concat('%',#{keyword}, '%') or
				 	  	   GAME_CONTENTS like concat('%',#{keyword}, '%') 
				</if>
			</if>
			order by GAME_KEY desc
			) A
			limit #{start}, #{pageSize}
		 
 		
</select>
	
	<select id="view" parameterType="String"  resultType="GameDto">
select
 		A.GAME_KEY
 		,A.TEAM_KEY
 		,A.GAME_DATE
 		 ,A.GAME_LOCATION
		 ,A.GAME_TITLE
		 ,A.GAME_CONTENTS
		 ,A.GAME_FDATE
    
FROM game A
where GAME_KEY = #{game_key};

	</select>
	
	
	<update id="update" parameterType="GameDto">
update game 
set GAME_TITLE = #{game_title}
	,GAME_DATE = now()
  ,GAME_CONTENTS= #{game_contents}
  ,GAME_FDATE = #{game_fdate}
  ,GAME_LOCATION = #{game_location}
where GAME_KEY = #{game_key};
	</update>
	
	<delete id="delete" parameterType="String">
		delete from game where GAME_KEY=#{game_key};
	</delete>
	
		<select id="getTotal" parameterType="GameDto" resultType="Integer">
		select count(*) from game 
		 <if test='key!=null and keyword!=null'>
				<if test='key=="1"'>
				 	where GAME_TITLE like concat('%',#{keyword}, '%')
				</if>
				<if test='key=="2"'>
				 	where GAME_CONTENTS like concat('%',#{keyword}, '%')	  
				</if>
				<if test='key=="3"'>
					 where GAME_TITLE like concat('%',#{keyword}, '%') or
				 	  	   GAME_CONTENTS like concat('%',#{keyword}, '%') 
				</if>
			</if>
	</select>
		
</mapper>
