<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="GameJoin">
	 
		<insert id="GameJoin_insert" parameterType="GameJoinDto">
		insert into matchingjoin
			(game_key, team_key, result_proc,matching_date)
			values
			(#{game_key}, #{team_key}, #{result_proc},now())
	    </insert>
	
		<select id="GameJoin_getList" parameterType="GameJoinDto"	resultType="GameJoinDto">
 		select 
 			matchingjoin_key
 			,game_key
 			,team_key
 			,result_proc
 			,matching_date
 			,rnum	
 		from
 		(
 		select
			A.matchingjoin_key
			,A.game_key
			,A.team_key
			,A.result_proc
			,A.matching_date
			,@rownum := @rownum+1 AS rnum
			from matchingjoin A, (select @rownum:=0) B
			where A.game_key = #{game_key}
			order by matchingjoin_key desc
			) A

	</select>
	
	<update id="Gamejoin_update" parameterType="GameJoinDto">
		<if test='result_proc == 2'>
			update matchingjoin set result_proc = '2' where matchingjoin_key=#{matchingjoin_key}	
		</if>
		
		
		<!-- <if test='result_proc == 3'>
			update matchingjoin set result_proc = '3' where matchingjoin_key=#{matchingjoin_key}	
		</if> 
		 -->
		 
	 <!-- 	<selectKey resultType="string" keyProperty="result_proc" order="BEFORE">
        	SELECT MAX(boardID)+1 FROM board  	      
    	</selectKey>   
    	
    	update matchingjoin set result_proc = '3' where game_key=35 And result_proc=1; -->
	</update>
	<select id="Gamejoin_getCount" parameterType="GameJoinDto" resultType="Integer">
		  select count(*) 
       	  from matchingjoin 
   		  where  game_key = #{game_key} AND team_key=
		    (
		        select team_key
		        from membership
		        where user_key = #{user_key}
		    )
	</select>
	
	<select id="Gamejoin_getTeamkey" parameterType="String" resultType="String">
			select team_key
			from membership
			where user_key=#{user_key}
	</select>
	
	<select id="GameJoin_getGameJoinResult" parameterType="GameJoinDto" resultType="String">
			select result_proc
			from matchingjoin
			where game_key =#{game_key} AND team_key=#{team_key}
	</select>
</mapper>